

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dropboxdol.connection &mdash; dropboxdol 0.0.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=47de8214"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dropboxdol
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol.html">dropboxdol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol/base.html">dropboxdol.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol/connection.html">dropboxdol.connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol/tests/base_test.html">dropboxdol.tests.base_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol/tests/test_dropbox.html">dropboxdol.tests.test_dropbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/dropboxdol/util.html">dropboxdol.util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dropboxdol</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dropboxdol.connection</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dropboxdol.connection</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Objects to connect to Dropbox.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dropbox</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dropboxdol.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_join</span><span class="p">,</span> <span class="n">DFLT_CONFIG_FILE</span><span class="p">,</span> <span class="n">config_store</span>


<div class="viewcode-block" id="get_tokens_interactive">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_tokens_interactive">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_tokens_interactive</span><span class="p">(</span><span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs an interactive OAuth flow to obtain an access token and a refresh token.</span>

<span class="sd">    Ensure you pass your Dropbox app key and secret. This flow will print an</span>
<span class="sd">    authorization URL. Visit the URL in your browser, authorize the app, then</span>
<span class="sd">    paste the resulting code into the prompt.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A tuple (access_token, refresh_token)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">DropboxOAuth2FlowNoRedirect</span><span class="p">(</span>
        <span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">,</span> <span class="n">token_access_type</span><span class="o">=</span><span class="s1">&#39;offline&#39;</span>
    <span class="p">)</span>
    <span class="n">authorize_url</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Go to: &quot;</span> <span class="o">+</span> <span class="n">authorize_url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Click &#39;Allow&#39; (you might need to log in first).&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Copy the authorization code and paste it in the user input dialogue.&quot;</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the authorization code here: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">oauth_result</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oauth_result</span><span class="o">.</span><span class="n">access_token</span><span class="p">,</span> <span class="n">oauth_result</span><span class="o">.</span><span class="n">refresh_token</span></div>



<div class="viewcode-block" id="get_envvar_if_upper_case_and_exists">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_envvar_if_upper_case_and_exists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_envvar_if_upper_case_and_exists</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a configuration value.</span>

<span class="sd">    First checks os.environ for the given key. If present, returns its value;</span>
<span class="sd">    otherwise, returns the key itself (allowing you to pass literal values).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">config</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">config</span></div>



<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dropbox</span>


<div class="viewcode-block" id="get_client_from_args">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_client_from_args">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_client_from_args</span><span class="p">(</span>
    <span class="n">oauth2_access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">oauth2_refresh_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">app_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Dropbox client using explicit credentials with additional validation.</span>

<span class="sd">    Validation includes:</span>
<span class="sd">      - Ensuring that oauth2_access_token is provided and is a non-empty string.</span>
<span class="sd">      - If any of oauth2_refresh_token, app_key, or app_secret are provided, then all must be provided</span>
<span class="sd">        to enable auto-refresh.</span>
<span class="sd">      - Issuing soft warnings if any of the parameters appear to be environment variable names</span>
<span class="sd">        (all uppercase), which might indicate that the caller intended to pass literal values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">      oauth2_access_token (str): The Dropbox access token.</span>
<span class="sd">      oauth2_refresh_token (str, optional): The Dropbox refresh token.</span>
<span class="sd">      app_key (str, optional): Your Dropbox app key.</span>
<span class="sd">      app_secret (str, optional): Your Dropbox app secret.</span>

<span class="sd">    Returns:</span>
<span class="sd">      dropbox.Dropbox: A Dropbox client instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Hard validation for oauth2_access_token.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">oauth2_access_token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oauth2_access_token</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A valid oauth2_access_token must be provided as a non-empty string.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Soft warning if oauth2_access_token is all uppercase (likely an env var name).</span>
    <span class="k">if</span> <span class="n">oauth2_access_token</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The provided oauth2_access_token appears to be all uppercase. &quot;</span>
            <span class="s2">&quot;This is typically used for environment variable names. &quot;</span>
            <span class="s2">&quot;If you intended to pass a literal token, consider using lowercase or mixed case.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Determine if auto-refresh is requested (i.e. any of the three additional parameters provided)</span>
    <span class="n">auto_refresh_requested</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">oauth2_refresh_token</span><span class="p">,</span> <span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">auto_refresh_requested</span><span class="p">:</span>
        <span class="c1"># All three must be provided if any are.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">oauth2_refresh_token</span> <span class="ow">and</span> <span class="n">app_key</span> <span class="ow">and</span> <span class="n">app_secret</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incomplete auto-refresh configuration: &quot;</span>
                <span class="s2">&quot;if you wish to enable auto-refresh, you must supply oauth2_refresh_token, app_key, and app_secret.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Soft warnings for each parameter if they appear to be env var names.</span>
        <span class="k">if</span> <span class="n">oauth2_refresh_token</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The provided oauth2_refresh_token appears to be all uppercase. &quot;</span>
                <span class="s2">&quot;Ensure you are passing the actual refresh token, not just the environment variable name.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">app_key</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The provided app_key appears to be all uppercase. &quot;</span>
                <span class="s2">&quot;Ensure you are passing the actual app key, not just the environment variable name.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">app_secret</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The provided app_secret appears to be all uppercase. &quot;</span>
                <span class="s2">&quot;Ensure you are passing the actual app secret, not just the environment variable name.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Instantiate an auto-refreshing Dropbox client.</span>
        <span class="k">return</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">(</span>
            <span class="n">oauth2_access_token</span><span class="o">=</span><span class="n">oauth2_access_token</span><span class="p">,</span>
            <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="n">oauth2_refresh_token</span><span class="p">,</span>
            <span class="n">app_key</span><span class="o">=</span><span class="n">app_key</span><span class="p">,</span>
            <span class="n">app_secret</span><span class="o">=</span><span class="n">app_secret</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no auto-refresh credentials are provided, create a basic client.</span>
        <span class="k">return</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">(</span><span class="n">oauth2_access_token</span><span class="o">=</span><span class="n">oauth2_access_token</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">config_file_to_dict</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">):</span>
        <span class="n">_config_filepath</span> <span class="o">=</span> <span class="n">config_filepath</span>
        <span class="n">config_filepath</span> <span class="o">=</span> <span class="n">config_join</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Neither configuration file &#39;</span><span class="si">{</span><span class="n">_config_filepath</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;nor </span><span class="si">{</span><span class="n">config_filepath</span><span class="si">}</span><span class="s2"> were found. &quot;</span>
                <span class="s2">&quot;Please ensure it exists.&quot;</span>
            <span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_only_non_none_values</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_assert_config_file_is_not_a_filepath</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;This function is for creating or editing configuration files of a &quot;</span>
            <span class="s2">&quot;dropboxdol maintained config store (config_store) only. &quot;</span>
            <span class="s2">&quot;The config_file you provided exists as an actual file, so I prefer to &quot;</span>
            <span class="s2">&quot;raise an error to bring that ambiguity to your attention.&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_config_store_value_or_empty_dict</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">_assert_config_file_is_not_a_filepath</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="p">{})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_or_edit_config_file</span><span class="p">(</span>
    <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">oauth2_access_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">app_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">app_secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">_config_store_value_or_empty_dict</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

    <span class="c1"># update config with non-None values</span>
    <span class="n">edits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">oauth2_access_token</span><span class="o">=</span><span class="n">oauth2_access_token</span><span class="p">,</span>
        <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="n">oauth2_refresh_token</span><span class="p">,</span>
        <span class="n">app_key</span><span class="o">=</span><span class="n">app_key</span><span class="p">,</span>
        <span class="n">app_secret</span><span class="o">=</span><span class="n">app_secret</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_only_non_none_values</span><span class="p">(</span><span class="n">edits</span><span class="p">))</span>

    <span class="n">config_store</span><span class="p">[</span><span class="n">config_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>


<span class="k">def</span><span class="w"> </span><span class="nf">complete_config_file_with_refresh_token</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config_store</span><span class="p">[</span><span class="n">config_file</span><span class="p">]</span>
    <span class="n">app_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;app_key&#39;</span><span class="p">]</span>
    <span class="n">app_secret</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;app_secret&#39;</span><span class="p">]</span>

    <span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">get_tokens_interactive</span><span class="p">(</span><span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">)</span>

    <span class="n">create_or_edit_config_file</span><span class="p">(</span>
        <span class="n">config_file</span><span class="p">,</span>
        <span class="n">oauth2_access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
        <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="create_config_file">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.create_config_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_config_file</span><span class="p">(</span>
    <span class="n">config_file</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">app_key</span><span class="p">,</span>
    <span class="n">app_secret</span><span class="p">,</span>
    <span class="n">oauth2_access_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a configuration file for a Dropbox client.</span>

<span class="sd">    If the file already exists, a FileExistsError will be raised.</span>
<span class="sd">    The `config_file` must be a sring ending with &#39;.json&#39;.</span>
<span class="sd">    If oauth2_refresh_token is not given, an interactive flow will be used to obtain it,</span>
<span class="sd">    also replacing the oauth2_access_token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">config_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">),</span> <span class="s2">&quot;Config file must end with &#39;.json&#39;&quot;</span>
    <span class="k">if</span> <span class="n">config_file</span> <span class="ow">in</span> <span class="n">config_store</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Configuration file &#39;</span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&#39; already exists. &quot;</span>
            <span class="s2">&quot;Please use create_or_edit_config_file() to edit it, or delete it first.&quot;</span>
        <span class="p">)</span>

    <span class="n">create_or_edit_config_file</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">app_key</span><span class="o">=</span><span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="o">=</span><span class="n">app_secret</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">oauth2_access_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">complete_config_file_with_refresh_token</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">create_or_edit_config_file</span><span class="p">(</span>
            <span class="n">config_file</span><span class="p">,</span>
            <span class="n">oauth2_access_token</span><span class="o">=</span><span class="n">oauth2_access_token</span><span class="p">,</span>
            <span class="n">oauth2_refresh_token</span><span class="o">=</span><span class="n">oauth2_refresh_token</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="copy_config_file">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.copy_config_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">copy_config_file</span><span class="p">(</span><span class="n">src_config_file</span><span class="p">,</span> <span class="n">dest_config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy a configuration file from one location to another.</span>

<span class="sd">    If the destination file already exists, a FileExistsError will be raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dest_config_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dest_config_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_config_file</span><span class="si">}</span><span class="s2">_copy.json&quot;</span>
    <span class="n">config_store</span><span class="p">[</span><span class="n">dest_config_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_store</span><span class="p">[</span><span class="n">src_config_file</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_client_from_config_file">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_client_from_config_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_client_from_config_file</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Dropbox client by loading configuration from a JSON file.</span>

<span class="sd">    The JSON file must contain the keys:</span>
<span class="sd">      - &quot;oauth2_access_token&quot;</span>
<span class="sd">      - &quot;oauth2_refresh_token&quot;</span>
<span class="sd">      - &quot;app_key&quot;</span>
<span class="sd">      - &quot;app_secret&quot;</span>

<span class="sd">    Raises:</span>
<span class="sd">      FileNotFoundError: If the config file does not exist.</span>
<span class="sd">      Exception: If required keys are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config_file_to_dict</span><span class="p">(</span><span class="n">config_filepath</span><span class="p">)</span>

    <span class="n">token</span><span class="p">,</span> <span class="n">refresh</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
        <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;oauth2_access_token&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth2_refresh_token&#39;</span><span class="p">,</span> <span class="s1">&#39;app_key&#39;</span><span class="p">,</span> <span class="s1">&#39;app_secret&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">refresh</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;Configuration file is missing one or more required keys: &quot;</span>
            <span class="s2">&quot;&#39;oauth2_access_token&#39;, &#39;oauth2_refresh_token&#39;, &#39;app_key&#39;, &#39;app_secret&#39;.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">get_client_from_args</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">refresh</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_getenv_or_none</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


<div class="viewcode-block" id="get_client_from_environment_vars">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_client_from_environment_vars">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_client_from_environment_vars</span><span class="p">(</span>
    <span class="n">oauth2_access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">oauth2_refresh_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">app_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Dropbox client using configuration from environment variables.</span>

<span class="sd">    The provided parameter names are interpreted as the names of the environment variables.</span>
<span class="sd">    For example, calling:</span>

<span class="sd">        get_client_from_environment_vars(&quot;DROPBOX_ACCESS_TOKEN&quot;, &quot;DROPBOX_REFRESH_TOKEN&quot;,</span>
<span class="sd">                                         &quot;DROPBOX_APP_KEY&quot;, &quot;DROPBOX_APP_SECRET&quot;)</span>

<span class="sd">    will use the values from os.environ (if they exist), or fall back to the literal strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">refresh</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
        <span class="n">get_envvar_if_upper_case_and_exists</span><span class="p">,</span>
        <span class="p">(</span><span class="n">oauth2_access_token</span><span class="p">,</span> <span class="n">oauth2_refresh_token</span><span class="p">,</span> <span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">get_client_from_args</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">refresh</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_client">
<a class="viewcode-back" href="../../module_docs/dropboxdol/connection.html#dropboxdol.connection.get_client">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_client</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">DFLT_CONFIG_FILE</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Dropbox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a Dropbox client using the best available configuration source.</span>

<span class="sd">    Priority:</span>
<span class="sd">      1. If an oauth2_access_token is provided and ends with &#39;.json&#39;, load configuration from that file.</span>
<span class="sd">      2. Else, if the environment variable (named by oauth2_access_token) exists, use environment variables.</span>
<span class="sd">      3. Otherwise, use explicit parameters provided via kwargs.</span>

<span class="sd">    Expected keyword arguments:</span>
<span class="sd">      - oauth2_access_token</span>
<span class="sd">      - oauth2_refresh_token</span>
<span class="sd">      - app_key</span>
<span class="sd">      - app_secret</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try to get the oauth2_access_token value</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">config_file_to_dict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid config. Should be a file name/path string or a dict </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># update kwargs with config</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="c1"># apply get_envvar_if_upper_case_and_exists to all kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">get_envvar_if_upper_case_and_exists</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">return</span> <span class="n">get_client_from_args</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>